(this.webpackJsonphackernews=this.webpackJsonphackernews||[]).push([[0],{100:function(e,n,t){},112:function(e,n,t){"use strict";t.r(n);var a=t(12),c=t(3),i=t(70),r=t.n(i),s=t(23),o=t(77),l=t(28),d=t(54),u=t(113),j=t(111),b=t(74),m=t(75),p=t(27),O=t(6),h=t(31),x=t(20),v=t(17),f=t(25),g=t(127),k="auth-token",y=t(124);function w(e){return function(e,n){var t=6e4,a=36e5,c=864e5,i=2592e6,r=31536e6,s=e-n;return s<2e4?"just now":s<t?"less than 1 min ago":s<a?Math.round(s/t)+" min ago":s<c?Math.round(s/a)+" h ago":s<i?Math.round(s/c)+" days ago":s<r?Math.round(s/i)+" mo ago":Math.round(s/r)+" years ago"}((new Date).getTime(),new Date(e).getTime())}var N,S,$,B,C,I,M,A,q=t(1),L=Object(f.a)(N||(N=Object(v.a)(["\n  mutation VoteMutation($linkId: ID!) {\n    vote(linkId: $linkId) {\n      id\n      link {\n        votes {\n          id\n          user {\n            id\n          }\n        }\n      }\n      user {\n        id\n      }\n    }\n  }\n"]))),Q=function(e){var n=e.link,t=localStorage.getItem(k),c={createdAt:"desc"},i=Object(g.a)(L,{variables:{linkId:n.id},update:function(e,t){var i=t.data.vote,r=e.readQuery({query:D,variables:{take:5,skip:0,orderBy:c}}).feed.links.map((function(e){return e.id===n.id?Object(a.a)(Object(a.a)({},e),{},{votes:[].concat(Object(h.a)(e.votes),[i])}):e}));e.writeQuery({query:D,data:{feed:{links:r}},variables:{take:5,skip:0,orderBy:c}})}}),r=Object(x.a)(i,1)[0];return Object(q.jsxs)("div",{className:"flex mt2 items-start",children:[Object(q.jsxs)("div",{className:"flex items-center",children:[Object(q.jsxs)("span",{className:"gray",children:[e.index+1,"."]}),t&&Object(q.jsx)("div",{className:"ml1 gray f11",style:{cursor:"pointer"},onClick:r,children:"\u25b2"})]}),Object(q.jsxs)("div",{className:"ml1",children:[Object(q.jsxs)("div",{children:[n.description," (",n.url,")"]}),t&&Object(q.jsxs)("div",{className:"f6 lh-copy gray",children:[n.votes.length," votes | by"," ",n.postedBy?n.postedBy.name:"Unknown"," ",w(n.createdAt)]})]})]})},D=Object(f.a)(S||(S=Object(v.a)(["\n  query FeedQuery(\n    $take: Int\n    $skip: Int\n    $orderBy: LinkOrderByInput\n  ) {\n    feed(take: $take, skip: $skip, orderBy: $orderBy) {\n      id\n      links {\n        id\n        url\n        description\n        postedBy {\n          id\n          name\n        }\n        votes {\n          id\n          user {\n            id\n          }\n        }\n        createdAt\n      }\n      count\n    }\n  }\n"]))),F=Object(f.a)($||($=Object(v.a)(["\n  subscription {\n    newLink {\n      id\n      url\n      description\n      postedBy {\n        id\n        name\n      }\n      votes {\n        id\n        user {\n          id\n        }\n      }\n      createdAt\n    }\n  }\n"]))),T=Object(f.a)(B||(B=Object(v.a)(["\n  subscription {\n    newVote {\n      id\n      link {\n        id\n        url\n        description\n        postedBy {\n          id\n          name\n        }\n        votes {\n          id\n          user {\n            id\n          }\n        }\n        createdAt\n      }\n      user {\n        id\n      }\n    }\n  }\n"]))),_=function(e,n){if(e)return n.feed.links;var t=n.feed.links.slice();return t.sort((function(e,n){return n.votes.length-e.votes.length})),t},J=function(e,n){return{take:e?5:100,skip:e?5*(n-1):0,orderBy:{createdAt:"desc"}}},P=function(){var e=Object(O.g)(),n=e.location.pathname.includes("new"),t=e.location.pathname.split("/"),a=parseInt(t[t.length-1]),c=a?5*(a-1):0,i=Object(y.a)(D,{variables:J(n,a)}),r=i.data,s=i.loading,o=i.error,l=i.subscribeToMore;return l({document:F,updateQuery:function(e,n){var t=n.subscriptionData;if(!t.data)return e;var a=t.data.newLink;return e.feed.links.find((function(e){return e.id===a.id}))?e:Object.assign({},e,{feed:{links:[a].concat(Object(h.a)(e.feed.links)),count:e.feed.links.length+1,__typename:e.feed.__typename}})}}),l({document:T}),Object(q.jsxs)(q.Fragment,{children:[s&&Object(q.jsx)("p",{children:"Loading..."}),o&&Object(q.jsx)("pre",{children:JSON.stringify(o,null,2)}),r&&Object(q.jsxs)(q.Fragment,{children:[_(n,r).map((function(e,n){return Object(q.jsx)(Q,{link:e,index:n+c},e.id)})),n&&Object(q.jsxs)("div",{className:"flex ml4 mv3 gray",children:[Object(q.jsx)("div",{className:"pointer mr2",onClick:function(){a>1&&e.push("/new/".concat(a-1))},children:"Previous"}),Object(q.jsx)("div",{className:"pointer",onClick:function(){if(a<=r.feed.count/5){var n=a+1;e.push("/new/".concat(n))}},children:"Next"})]})]})]})},U=Object(f.a)(C||(C=Object(v.a)(["\n  mutation PostMutation(\n    $description: String!\n    $url: String!\n  ) {\n    post(description: $description, url: $url) {\n      id\n      url\n      description\n    }\n  }\n"]))),V=function(){var e=Object(O.g)(),n=Object(c.useState)({description:"",url:""}),t=Object(x.a)(n,2),i=t[0],r=t[1],s=Object(g.a)(U,{variables:{description:i.description,url:i.url},update:function(e,n){var t=n.data.post,a={createdAt:"desc"},c=e.readQuery({query:D,variables:{take:5,skip:0,orderBy:a}});e.writeQuery({query:D,data:{feed:{links:[t].concat(Object(h.a)(c.feed.links))}},variables:{take:5,skip:0,orderBy:a}})},onCompleted:function(){return e.push("/new/1")}}),o=Object(x.a)(s,1)[0];return Object(q.jsx)("div",{children:Object(q.jsxs)("form",{onSubmit:function(e){e.preventDefault(),o()},children:[Object(q.jsxs)("div",{className:"flex flex-column mt3",children:[Object(q.jsx)("input",{className:"mb2",value:i.description,onChange:function(e){return r(Object(a.a)(Object(a.a)({},i),{},{description:e.target.value}))},type:"text",placeholder:"A description for the link"}),Object(q.jsx)("input",{className:"mb2",value:i.url,onChange:function(e){return r(Object(a.a)(Object(a.a)({},i),{},{url:e.target.value}))},type:"text",placeholder:"The URL for the link"})]}),Object(q.jsx)("button",{type:"submit",children:"Submit"})]})})},W=function(){var e=Object(O.g)(),n=localStorage.getItem(k);return Object(q.jsxs)("div",{className:"flex pa1 justify-between nowrap orange",children:[Object(q.jsxs)("div",{className:"flex flex-fixed black",children:[Object(q.jsx)("div",{className:"fw7 mr1",children:"Hacker News"}),Object(q.jsx)(s.b,{to:"/",className:"ml1 no-underline black",children:"new"}),Object(q.jsx)("div",{className:"ml1",children:"|"}),Object(q.jsx)(s.b,{to:"/top",className:"ml1 no-underline black",children:"top"}),Object(q.jsx)("div",{className:"ml1",children:"|"}),Object(q.jsx)(s.b,{to:"/search",className:"ml1 no-underline black",children:"search"}),n&&Object(q.jsxs)("div",{className:"flex",children:[Object(q.jsx)("div",{className:"ml1",children:"|"}),Object(q.jsx)(s.b,{to:"/create",className:"ml1 no-underline black",children:"submit"})]})]}),Object(q.jsx)("div",{className:"flex flex-fixed",children:n?Object(q.jsx)("div",{className:"ml1 pointer black",onClick:function(){localStorage.removeItem(k),e.push("/")},children:"logout"}):Object(q.jsx)(s.b,{to:"/login",className:"ml1 no-underline black",children:"login"})})]})},Y=Object(f.a)(I||(I=Object(v.a)(["\n  mutation SignupMutation(\n    $email: String!\n    $password: String!\n    $name: String!\n  ) {\n    signup(\n      email: $email\n      password: $password\n      name: $name\n    ) {\n      token\n    }\n  }\n"]))),z=Object(f.a)(M||(M=Object(v.a)(["\n  mutation LoginMutation(\n    $email: String!\n    $password: String!\n  ) {\n    login(email: $email, password: $password) {\n      token\n    }\n  }\n"]))),E=function(){var e=Object(O.g)(),n=Object(c.useState)({login:!0,email:"",password:"",name:""}),t=Object(x.a)(n,2),i=t[0],r=t[1],s=Object(g.a)(z,{variables:{email:i.email,password:i.password},onCompleted:function(n){var t=n.login;localStorage.setItem(k,t.token),e.push("/")}}),o=Object(x.a)(s,1)[0],l=Object(g.a)(Y,{variables:{name:i.name,email:i.email,password:i.password},onCompleted:function(n){var t=n.signup;localStorage.setItem(k,t.token),e.push("/")}}),d=Object(x.a)(l,1)[0];return Object(q.jsxs)("div",{children:[Object(q.jsx)("h4",{className:"mv3",children:o?"Login":"Sign Up"}),Object(q.jsxs)("div",{className:"flex flex-column",children:[!i.login&&Object(q.jsx)("input",{value:i.name,onChange:function(e){return r(Object(a.a)(Object(a.a)({},i),{},{name:e.target.value}))},type:"text",placeholder:"Your name"}),Object(q.jsx)("input",{value:i.email,onChange:function(e){return r(Object(a.a)(Object(a.a)({},i),{},{email:e.target.value}))},type:"text",placeholder:"Your email address"}),Object(q.jsx)("input",{value:i.password,onChange:function(e){return r(Object(a.a)(Object(a.a)({},i),{},{password:e.target.value}))},type:"password",placeholder:"Choose a safe password"})]}),Object(q.jsxs)("div",{className:"flex mt3",children:[Object(q.jsx)("button",{className:"pointer mr2 button",onClick:i.login?o:d,children:i.login?"login":"create account"}),Object(q.jsx)("button",{className:"pointer button",onClick:function(e){return r(Object(a.a)(Object(a.a)({},i),{},{login:!i.login}))},children:i.login?"need to create an account?":"already have an account?"})]})]})},H=t(125),K=Object(f.a)(A||(A=Object(v.a)(["\n  query FeedSearchQuery($filter: String!) {\n    feed(filter: $filter) {\n      id\n      links {\n        id\n        url\n        description\n        postedBy {\n          id\n          name\n        }\n        votes {\n          id\n          user {\n            id\n          }\n        }\n        createdAt\n      }\n    }\n  }\n"]))),R=function(){var e=Object(c.useState)(""),n=Object(x.a)(e,2),t=n[0],a=n[1],i=Object(H.a)(K),r=Object(x.a)(i,2),s=r[0],o=r[1].data;return Object(q.jsxs)(q.Fragment,{children:[Object(q.jsxs)("div",{children:["Search",Object(q.jsx)("input",{type:"text",onChange:function(e){return a(e.target.value)}}),Object(q.jsx)("button",{onClick:function(){return s({variables:{filter:t}})},children:"OK"})]}),o&&o.feed.links.map((function(e,n){return Object(q.jsx)(Q,{link:e,index:n},e.id)}))]})},G=function(){return Object(q.jsxs)("div",{className:"center w85",children:[Object(q.jsx)(W,{}),Object(q.jsx)("div",{className:"ph3 pv1 background-gray",children:Object(q.jsxs)(O.d,{children:[Object(q.jsx)(O.b,{exact:!0,path:"/",render:function(){return Object(q.jsx)(O.a,{to:"/new/1"})}}),Object(q.jsx)(O.b,{exact:!0,path:"/create",component:V}),Object(q.jsx)(O.b,{exact:!0,path:"/login",component:E}),Object(q.jsx)(O.b,{exact:!0,path:"/search",component:R}),Object(q.jsx)(O.b,{exact:!0,path:"/top",component:P}),Object(q.jsx)(O.b,{exact:!0,path:"/new/:page",component:P})]})})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));t(100);var X=Object(o.a)({uri:"http://localhost:4000"}),Z=Object(b.a)((function(e,n){var t=n.headers,c=localStorage.getItem(k);return{headers:Object(a.a)(Object(a.a)({},t),{},{authorization:c?"Bearer ".concat(c):""})}})),ee=new m.a({uri:"ws://localhost:4000/graphql",options:{reconnect:!0,connectionParams:{authToken:localStorage.getItem(k)}}}),ne=Object(l.split)((function(e){var n=e.query,t=Object(p.e)(n),a=t.kind,c=t.operation;return"OperationDefinition"===a&&"subscription"===c}),ee,Z.concat(X)),te=new d.a({link:ne,cache:new u.a});r.a.render(Object(q.jsx)(s.a,{children:Object(q.jsx)(j.a,{client:te,children:Object(q.jsx)(G,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[112,1,2]]]);
//# sourceMappingURL=main.0f30ce54.chunk.js.map